SHELL := /bin/bash
.PHONY: help setup docker run test

VERSION	= $(shell cat pyproject.toml | grep "^version = \"*\"" | cut -d'"' -f2)
IMAGE = skel/my_app

help:			## Show this help
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z0-9_-]+:.*?## / {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)

setup:		## Setup a dev environment
	# Reset venv
	@rm -rf venv
	# Create new python environment
	python3 -m venv venv
	source venv/bin/activate && pip install --upgrade pip wheel poetry && poetry install

test:			## Run tests
	source venv/bin/activate && python -m pytest

##
## Targets
##

requirements.txt: pyproject.toml	## Recipe for refreshing requirements.txt from pyproject.toml
	@echo "# THIS FILE IS AUTOMATICALLY GENERATED. DO NOT EDIT." > requirements.txt
	@echo "./" >> requirements.txt
	poetry export --without-hashes >> requirements.txt
